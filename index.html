<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Part 13 ‚Äî Context, Standpoint & Repair (with Tracking)</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
    body { font-family: 'Inter', sans-serif; }
    .fade-in { animation: fadeIn .3s ease; }
    @keyframes fadeIn { from{opacity:0;transform:translateY(4px)} to{opacity:1;transform:translateY(0)} }
  </style>
</head>
<body class="bg-gray-50">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useMemo } = React;

    // -----------------------------
    // Utils
    // -----------------------------
    const STORAGE_KEY = 'part13_app_state_v2';

    const generateSessionId = () => {
      const d = new Date();
      const dateStr = d.toISOString().slice(0,10).replace(/-/g,'');
      const timeStr = d.toTimeString().slice(0,8).replace(/:/g,'');
      const rnd = Math.random().toString(36).slice(2,8).toUpperCase();
      return `P13-${dateStr}-${timeStr}-${rnd}`;
    };

    const nowISO = () => new Date().toISOString();

    // -----------------------------
    // Data (distinct per section)
    // -----------------------------
    const NAV_SECTIONS = [
      { id: 'overview', label: 'Overview', icon: 'üåç' },
      { id: 'concepts', label: 'Core Concepts', icon: 'üß≠' },
      { id: 'threads', label: 'Threads & Influences', icon: 'üß∂' },
      { id: 'patterns', label: 'Design Patterns', icon: 'üõ†Ô∏è' },
      { id: 'example', label: 'Worked Example', icon: 'üìã' },
      { id: 'assessment', label: 'Assessment & Reflection', icon: '‚úÖ' },
    ];

    const OVERVIEW = {
      title: 'Part 13 ‚Äî Global & Decolonial Philosophies; Feminist ‚Ä¢ Critical Race ‚Ä¢ Indigenous Thought',
      bigQuestion: 'Who gets to set the ‚Äúcontext,‚Äù and how does standpoint change what counts as knowledge?',
      capabilities: [
        'Epistemic justice (fair credibility, concept access, uptake of reasons)',
        'Pluralism by design (hold multiple knowledge systems together)',
        'Repair & recognition (truth, acknowledgement, remedy, review)'
      ],
      abcd: [
        { letter: 'A', title: 'Agency', line: 'Voice, authorship, co-governance' },
        { letter: 'B', title: 'Beauty/Awe', line: 'Felt dignity of plurality' },
        { letter: 'C', title: 'Context', line: 'Institutional gates: rubrics, concepts, procedures' },
        { letter: 'D', title: 'Dynamics', line: 'Power feedbacks, path dependence, scheduled audits' },
      ],
      levels: [
        { level: 'Capacity', cue: 'Reasons exist but credibility gates/terms suppress expression' },
        { level: 'Capability', cue: 'Calibrated criteria + shared language enable reliable contribution' },
        { level: 'Constructor', cue: 'Standing procedures (committees, challenge channels, change-logs)' },
        { level: 'Meta-constructor', cue: 'Scheduled audits/amendments; rotating roles; versioned concepts' },
      ]
    };

    const CONCEPTS = [
      {
        id: 'testimonial-injustice',
        title: 'Testimonial injustice',
        summary: 'A speaker‚Äôs credibility is discounted due to identity-coded cues rather than evidence.',
        abcd: ['A (voice)', 'C (gates)'],
        levelMove: 'Capacity ‚Üí Capability (explicit credibility criteria)',
        pattern: [
          'Replace vibe-words with calibrated descriptors tied to rubric criteria',
          'Enable multiple delivery modes for the same competence'
        ],
        watch: 'Over-correcting by dropping standards instead of clarifying them',
        check: 'Inter-rater reliability ‚Üë; variance across identity groups ‚Üì'
      },
      {
        id: 'hermeneutical-injustice',
        title: 'Hermeneutical injustice',
        summary: 'Missing shared concepts render experiences unintelligible to the group.',
        abcd: ['C (concept infrastructure)', 'D (concept growth)'],
        levelMove: 'Meta-constructor (scheduled lexicon updates)',
        pattern: [
          'Coin local terms; add to a public glossary with examples & dates',
          'Embed terms into prompts/rubrics so they are actually used'
        ],
        watch: 'Private jargon without community uptake',
        check: 'Glossary cited in work; terms appear in rubrics and feedback'
      },
      {
        id: 'standpoint-methodology',
        title: 'Standpoint methodology',
        summary: 'Inquiry improves by systematically including differently situated knowers.',
        abcd: ['A (authorship)', 'B (plural dignity)'],
        levelMove: 'Capacity ‚Üí Capability (roles/prompts require standpoints)',
        pattern: [
          'Dual-track evidence (textual analysis + lived expertise/interview)',
          'Require explicit triangulation notes'
        ],
        watch: 'Tokenism without power-sharing in decision points',
        check: 'Decision notes explain how standpoint evidence altered conclusions'
      },
      {
        id: 'two-eyed-seeing',
        title: 'Two-Eyed Seeing (Etuaptmumk)',
        summary: 'Hold two knowledge systems together for joint problem solving.',
        abcd: ['B (awe of plurality)', 'C (protected lanes)', 'D (co-evolution)'],
        levelMove: 'Constructor (routine persists & socializes newcomers)',
        pattern: [
          'Pair close reading with community-located method',
          'Produce dual artifacts; run a joint critique'
        ],
        watch: 'One eye quietly dominating the other',
        check: 'Outputs keep both lanes legible; reviewers from each lane sign off'
      },
      {
        id: 'participatory-repair',
        title: 'Participatory repair (Truth‚ÄìRecognition‚ÄìRemedy‚ÄìReview)',
        summary: 'From apology to actionable remedy with a calendar and owners.',
        abcd: ['D (loops)', 'C (procedures)'],
        levelMove: 'Meta-constructor (living change-log & scheduled re-checks)',
        pattern: [
          'Narration ‚Üí acknowledgement ‚Üí remedy (owners/resources/dates) ‚Üí pre-scheduled review'
        ],
        watch: 'Symbolic statements without resource commitments',
        check: 'Change-log shows closed items and next reviews'
      },
    ];

    const THREADS = [
      { id:'derrida', name:'Derrida', hook:'Deconstruction, diff√©rance, trace', takeaway:'Context is never neutral; meaning travels through exclusions.', abcd:['C','D'] },
      { id:'foucault', name:'Foucault', hook:'Power/knowledge, genealogy', takeaway:'Institutions make some knowledges sayable/doable.', abcd:['C','D'] },
      { id:'beauvoir', name:'Beauvoir', hook:'The Other, situated freedom', takeaway:'Roles and recognition obstruct or enable agency.', abcd:['A','C'] },
      { id:'said', name:'Said', hook:'Orientalism', takeaway:'Stereotype machines shape what counts as ‚Äúcivilization.‚Äù', abcd:['C'] },
      { id:'spivak', name:'Spivak', hook:'Subaltern', takeaway:'Frames can translate away expression by design.', abcd:['A','C'] },
      { id:'fanon', name:'Fanon', hook:'Colonial subjectivity, decolonization', takeaway:'Repair requires material change, not only narrative.', abcd:['D','C'] },
      { id:'lugones-anzaldua', name:'Lugones & Anzald√∫a', hook:'World-traveling, borderlands', takeaway:'Plural identities as method; code-switching becomes capability.', abcd:['A','B','C'] },
      { id:'dotson', name:'Dotson', hook:'Epistemic oppression', takeaway:'Systemic patterns can preclude participation.', abcd:['C','D'] },
      { id:'smith', name:'Linda Tuhiwai Smith', hook:'Decolonizing methodologies', takeaway:'Community-governed research; protocols as constructors.', abcd:['C','D'] },
      { id:'santos', name:'Boaventura de Sousa Santos', hook:'Epistemologies of the South', takeaway:'Abyssal lines; ecology of knowledges.', abcd:['B','C'] },
      { id:'simpson', name:'Leanne Betasamosake Simpson', hook:'Resurgence', takeaway:'Everyday practice as a living constructor of sovereignty.', abcd:['A','D'] },
    ];

    const PATTERNS = [
      {
        id: 'inclusive-procedure',
        title: 'Inclusive Procedure Pack',
        goal: 'Convert capacity ‚Üí capability ‚Üí constructor',
        steps: [
          'Rubric refit: replace impressionistic language with calibrated descriptors & accepted evidence types',
          'Dual-track submissions (define standards per lane)',
          'Challenge channel: anonymous form + dated response ‚Üí public change-log',
          'Standing co-review: rotating peer/community member; decision notes log ‚Äúhow it changed the outcome‚Äù'
        ],
        abcd: 'C (gates), A (voice), D (review cadence), B (dignity visible)'
      },
      {
        id: 'mini-trc',
        title: 'Mini-TRC (Truth‚ÄìRecognition‚ÄìRemedy‚ÄìReview)',
        goal: 'Move from apology to scheduled remedy',
        steps: [
          'Truth: document pattern with multiple standpoints',
          'Recognition: publish a short acknowledgement brief',
          'Remedy: concrete actions, owners, resources, dates',
          'Review: pre-schedule follow-up; update change-log'
        ],
        levels: 'Pushes toward meta-constructor'
      },
      {
        id: 'two-eyed-studio',
        title: 'Two-Eyed Studio',
        goal: 'Keep both knowledge lanes legible',
        steps: [
          'Artifact 1: close textual/analytic product',
          'Artifact 2: community-located product (interview/mapping/storywork)',
          'Joint critique: alignments/divergences; redesign that retains both lanes'
        ],
        guard: 'Prevent one lane from silently dominating the other'
      }
    ];

    const EXAMPLE = {
      title: 'Worked Example ‚Äî Redesign a Midterm Essay Rubric',
      old: '‚ÄúClarity, logic, originality (30 pts)‚Äù ‚Üí strong lived reasoning under-scored',
      steps: [
        'Capacity diagnostic: reasons exist; lane too narrow',
        'Capability move: split into 3 calibrated criteria (argument quality, evidence integration, translation skill)',
        'Constructor move: add rotating co-review; require a short ‚Äúhow it changed my draft‚Äù section',
        'Meta-constructor move: term-end rubric audit; compare variance; submit a one-page change proposal'
      ],
      abcdCheck: [
        'A: co-authored co-review',
        'B: plural exemplars are showcased',
        'C: widened, explicit gates',
        'D: scheduled audit'
      ],
      metric: 'Inter-rater reliability ‚Üë, group gaps ‚Üì, self-efficacy ‚Üë'
    };

    const ASSESSMENT = {
      rubric: [
        { level: 'Mastered', text: 'Designs/revises a procedure that widens evidence lanes, embeds challenge/change-log, and runs a scheduled review that leads to an amendment.' },
        { level: 'Proficient', text: 'Applies two core concepts to redesign a rubric/activity; includes co-review and a dated follow-up; partial calibration present.' },
        { level: 'Developing', text: 'Identifies harm and names concepts; proposed fixes lack procedural detail or schedule.' },
        { level: 'Novice', text: 'Describes issues in general terms; no link to procedures or ABCD/Levels.' },
      ],
      prompts: [
        'Where do context gates silently shape whose reasons count in your setting?',
        'Which two concepts will you implement next week? How, exactly?',
        'What does repair look like here (owners, resources, dates, next review)?'
      ],
      toolkit: [
        'ABCD card: A (voice), B (plural dignity), C (gates), D (loops)',
        'Levels cue: Capacity? Capability? Constructor? Meta-constructor?',
        'Mini-TRC checklist: Truth ‚Üí Recognition ‚Üí Remedy ‚Üí Review (dated)',
        'Change-log: Item | Rationale | Owner | Resources | Due | Status | Next review',
        'Glossary line: Term | Plain definition | Example | Introduced by | Date | Next review'
      ]
    };

    // -----------------------------
    // Reusable UI
    // -----------------------------
    const SectionCard = ({ children }) => (
      <div className="bg-white shadow rounded-lg p-6 fade-in">{children}</div>
    );

    const Pill = ({ children }) => (
      <span className="inline-block text-xs font-semibold px-2 py-1 rounded-full bg-purple-100 text-purple-700 mr-2 mb-2">
        {children}
      </span>
    );

    const Accordion = ({ items, idPrefix, onInteraction }) => {
      const [openSet, setOpenSet] = useState(new Set());
      const toggle = (id) => {
        setOpenSet(prev => {
          const next = new Set(prev);
          if (next.has(id)) next.delete(id); else next.add(id);
          return next;
        });
        onInteraction?.();
      };
      return (
        <div className="space-y-3">
          {items.map(item => {
            const open = openSet.has(item.id);
            return (
              <div key={`${idPrefix}-${item.id}`} className="border rounded-lg bg-white">
                <button
                  className="w-full text-left px-4 py-3 flex items-center justify-between hover:bg-gray-50"
                  onClick={() => toggle(item.id)}
                  aria-expanded={open}
                  aria-controls={`${idPrefix}-panel-${item.id}`}
                  id={`${idPrefix}-button-${item.id}`}
                >
                  <span className="font-semibold text-gray-900">{item.title || item.name}</span>
                  <span className="text-gray-500">{open ? '‚ñ≤' : '‚ñº'}</span>
                </button>
                {open && (
                  <div
                    id={`${idPrefix}-panel-${item.id}`}
                    className="px-4 pb-4 pt-2 border-t fade-in"
                    role="region"
                    aria-labelledby={`${idPrefix}-button-${item.id}`}
                  >
                    {'summary' in item && (
                      <p className="text-gray-700 mb-2">{item.summary}</p>
                    )}

                    {'hook' in item && (
                      <div>
                        <p className="text-sm text-gray-600"><span className="font-semibold">Hook:</span> {item.hook}</p>
                        <p className="text-sm text-gray-600 mt-1"><span className="font-semibold">Takeaway:</span> {item.takeaway}</p>
                        <div className="mt-2">
                          {item.abcd.map((t, i) => <Pill key={`${item.id}-tag-${i}`}>{t}</Pill>)}
                        </div>
                      </div>
                    )}

                    {'abcd' in item && Array.isArray(item.abcd) && item.abcd.length > 0 && !('hook' in item) && (
                      <div className="mt-2">
                        <div className="mb-1 text-sm text-gray-600 font-semibold">ABCD</div>
                        <div>{item.abcd.map((t, i) => <Pill key={`${item.id}-abcd-${i}`}>{t}</Pill>)}</div>
                      </div>
                    )}

                    {'levelMove' in item && (
                      <p className="text-sm text-gray-600 mt-2"><span className="font-semibold">Four-Levels leverage:</span> {item.levelMove}</p>
                    )}

                    {'pattern' in item && Array.isArray(item.pattern) && (
                      <div className="mt-2">
                        <div className="text-sm font-semibold text-gray-700">Use it (pattern)</div>
                        <ul className="list-disc list-inside text-sm text-gray-700">
                          {item.pattern.map((p, i) => <li key={`${item.id}-p-${i}`}>{p}</li>)}
                        </ul>
                      </div>
                    )}

                    {'watch' in item && (
                      <p className="text-sm text-gray-600 mt-2"><span className="font-semibold">Watch for:</span> {item.watch}</p>
                    )}

                    {'check' in item && (
                      <p className="text-sm text-gray-600 mt-1"><span className="font-semibold">Checkpoint:</span> {item.check}</p>
                    )}
                  </div>
                )}
              </div>
            );
          })}
        </div>
      );
    };

    // -----------------------------
    // Sections
    // -----------------------------
    const Overview = ({ onInteraction }) => (
      <SectionCard>
        <h1 className="text-2xl font-bold text-gray-900">{OVERVIEW.title}</h1>
        <div className="mt-4 p-4 bg-blue-50 border-l-4 border-blue-400 rounded">
          <p className="font-semibold text-blue-900">Big Question</p>
          <p className="text-gray-800">{OVERVIEW.bigQuestion}</p>
        </div>

        <div className="mt-6">
          <h2 className="text-lg font-semibold text-gray-900">Capabilities</h2>
          <ul className="list-disc list-inside text-gray-700 mt-2">
            {OVERVIEW.capabilities.map((c,i)=><li key={`cap-${i}`}>{c}</li>)}
          </ul>
        </div>

        <div className="mt-6 grid md:grid-cols-2 gap-4">
          <div className="bg-purple-50 p-4 rounded border border-purple-200">
            <h3 className="font-semibold text-purple-900 mb-2">ABCD Lens</h3>
            <ul className="text-gray-700 list-disc list-inside">
              {OVERVIEW.abcd.map((x,i)=><li key={`abcd-${i}`}><span className="font-semibold">{x.letter} ‚Äî {x.title}:</span> {x.line}</li>)}
            </ul>
          </div>
          <div className="bg-green-50 p-4 rounded border border-green-200">
            <h3 className="font-semibold text-green-900 mb-2">Four-Level Diagnostic</h3>
            <ul className="text-gray-700 list-disc list-inside">
              {OVERVIEW.levels.map((x,i)=><li key={`lvl-${i}`}><span className="font-semibold">{x.level}:</span> {x.cue}</li>)}
            </ul>
          </div>
        </div>
      </SectionCard>
    );

    const Concepts = ({ onInteraction }) => (
      <SectionCard>
        <div className="flex items-center justify-between">
          <h2 className="text-xl font-bold text-gray-900">Core Concepts (quick refresher + application)</h2>
        </div>
        <p className="text-gray-700 mt-2 mb-4">Each entry ties concept ‚Üí ABCD ‚Üí Four-Levels ‚Üí practice pattern ‚Üí pitfalls ‚Üí checkpoint.</p>
        <Accordion items={CONCEPTS} idPrefix="concepts" onInteraction={onInteraction}/>
      </SectionCard>
    );

    const Threads = ({ onInteraction }) => (
      <SectionCard>
        <h2 className="text-xl font-bold text-gray-900">Threads & Influences (concepts as tools)</h2>
        <p className="text-gray-700 mt-2 mb-4">
          Use these names as handles for design moves (e.g., ‚ÄúDo a genealogical audit,‚Äù ‚ÄúAdd a borderlands lane‚Äù).
        </p>
        <Accordion items={THREADS} idPrefix="threads" onInteraction={onInteraction}/>
      </SectionCard>
    );

    const Patterns = ({ onInteraction }) => (
      <SectionCard>
        <h2 className="text-xl font-bold text-gray-900">Design Patterns (ready-to-run)</h2>
        <div className="mt-4 space-y-4">
          {PATTERNS.map(p => (
            <div key={p.id} className="border rounded-lg p-4 bg-gray-50">
              <h3 className="font-semibold text-gray-900">{p.title}</h3>
              <p className="text-sm text-gray-700 mt-1"><span className="font-semibold">Goal:</span> {p.goal}</p>
              <ul className="list-disc list-inside text-gray-700 mt-2">
                {p.steps.map((s,i)=><li key={`${p.id}-s-${i}`}>{s}</li>)}
              </ul>
              {p.abcd && <p className="text-sm text-gray-700 mt-2"><span className="font-semibold">ABCD:</span> {p.abcd}</p>}
              {p.levels && <p className="text-sm text-gray-700 mt-1"><span className="font-semibold">Levels:</span> {p.levels}</p>}
              {p.guard && <p className="text-sm text-gray-700 mt-1"><span className="font-semibold">Guardrail:</span> {p.guard}</p>}
            </div>
          ))}
        </div>
      </SectionCard>
    );

    const Example = ({ onInteraction }) => (
      <SectionCard>
        <h2 className="text-xl font-bold text-gray-900">{EXAMPLE.title}</h2>
        <div className="mt-2 p-4 bg-yellow-50 border-l-4 border-yellow-400 rounded">
          <p className="text-gray-800"><span className="font-semibold">Old issue:</span> {EXAMPLE.old}</p>
        </div>
        <div className="mt-4">
          <h3 className="font-semibold text-gray-900">Steps</h3>
          <ol className="list-decimal list-inside text-gray-700 mt-1">
            {EXAMPLE.steps.map((s,i)=><li key={`ex-s-${i}`}>{s}</li>)}
          </ol>
        </div>
        <div className="mt-4">
          <h3 className="font-semibold text-gray-900">ABCD check</h3>
          <ul className="list-disc list-inside text-gray-700 mt-1">
            {EXAMPLE.abcdCheck.map((s,i)=><li key={`ex-a-${i}`}>{s}</li>)}
          </ul>
        </div>
        <p className="text-gray-700 mt-3"><span className="font-semibold">Metric:</span> {EXAMPLE.metric}</p>
      </SectionCard>
    );

    const Assessment = ({ onInteraction }) => (
      <SectionCard>
        <h2 className="text-xl font-bold text-gray-900">Assessment & Reflection</h2>
        <div className="mt-4 grid md:grid-cols-2 gap-4">
          <div className="bg-white border rounded-lg p-4">
            <h3 className="font-semibold text-gray-900">Prose Rubric</h3>
            <ul className="list-disc list-inside text-gray-700 mt-2">
              {ASSETS.rubricList()}
            </ul>
          </div>
          <div className="bg-white border rounded-lg p-4">
            <h3 className="font-semibold text-gray-900">Reflection Prompts</h3>
            <ul className="list-disc list-inside text-gray-700 mt-2">
              {ASSETS.promptList()}
            </ul>
          </div>
        </div>
        <div className="bg-gray-100 border rounded-lg p-4 mt-4">
          <h3 className="font-semibold text-gray-900">One-Page Toolkit</h3>
          <ul className="list-disc list-inside text-gray-700 mt-2">
            {ASSETS.toolkitList()}
          </ul>
        </div>
      </SectionCard>
    );

    // Helpers to render lists (keeps JSX above tidy)
    const ASSETS = {
      rubricList() {
        return ASSESSMENT.rubric.map((r,i)=><li key={`rub-${i}`}><span className="font-semibold">{r.level}:</span> {r.text}</li>);
      },
      promptList() {
        return ASSESSMENT.prompts.map((p,i)=><li key={`pr-${i}`}>{p}</li>);
      },
      toolkitList() {
        return ASSESSMENT.toolkit.map((t,i)=><li key={`tk-${i}`}>{t}</li>);
      }
    };

    // -----------------------------
    // Welcome Screen
    // -----------------------------
    function Welcome({ onStart }) {
      const [form, setForm] = useState({ name:'', email:'', course:'' });
      const valid = form.name && form.email && form.course;

      const submit = (e) => {
        e.preventDefault();
        if (!valid) return;
        onStart(form);
      };

      return (
        <div className="min-h-screen bg-gradient-to-br from-purple-600 to-indigo-600">
          <div className="max-w-3xl mx-auto px-4 py-12">
            <div className="bg-white rounded-xl shadow-2xl p-8">
              <h1 className="text-3xl font-extrabold text-gray-900">Part 13 ‚Äî Context, Standpoint & Repair</h1>
              <p className="mt-2 text-gray-700">Global & Decolonial ‚Ä¢ Feminist ‚Ä¢ Critical Race ‚Ä¢ Indigenous Thought</p>

              <div className="mt-6 p-4 rounded-lg bg-blue-50 border-l-4 border-blue-400">
                <p className="text-gray-800"><span className="font-semibold">Big Question:</span> Who sets the context, and how does standpoint change what counts as knowledge?</p>
              </div>

              <form onSubmit={submit} className="mt-8 space-y-4">
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">Full Name *</label>
                  <input className="w-full border rounded-lg px-4 py-2 focus:ring-2 focus:ring-purple-500"
                         value={form.name} onChange={e=>setForm({...form, name:e.target.value})} required/>
                </div>
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">Email *</label>
                  <input type="email" className="w-full border rounded-lg px-4 py-2 focus:ring-2 focus:ring-purple-500"
                         value={form.email} onChange={e=>setForm({...form, email:e.target.value})} required/>
                </div>
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">Course / Section *</label>
                  <input className="w-full border rounded-lg px-4 py-2 focus:ring-2 focus:ring-purple-500"
                         value={form.course} onChange={e=>setForm({...form, course:e.target.value})} required/>
                </div>
                <button type="submit"
                        className="w-full mt-2 bg-purple-600 hover:bg-purple-700 text-white font-semibold py-3 rounded-lg">
                  Go to Part 13 ‚Üí
                </button>
              </form>
            </div>
          </div>
        </div>
      );
    }

    // -----------------------------
    // App with tracking
    // -----------------------------
    function App() {
      const [hasStarted, setHasStarted] = useState(false);
      const [student, setStudent] = useState({ name:'', email:'', course:'' });
      const [session, setSession] = useState(null);
      const [current, setCurrent] = useState('overview');
      const [sectionProgress, setSectionProgress] = useState({}); // id -> {started, startTime, endTime, timeSpent, interactions, status}

      // load saved
      useEffect(() => {
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          if (raw) {
            const data = JSON.parse(raw);
            if (data && data.hasStarted) {
              setHasStarted(true);
              setStudent(data.student || {name:'', email:'', course:''});
              setSession(data.session || null);
              setCurrent(data.current || 'overview');
              setSectionProgress(data.sectionProgress || {});
            }
          }
        } catch (e) { /* ignore */ }
      }, []);

      // persist
      useEffect(() => {
        const payload = { hasStarted, student, session, current, sectionProgress };
        localStorage.setItem(STORAGE_KEY, JSON.stringify(payload));
      }, [hasStarted, student, session, current, sectionProgress]);

      const startModule = (info) => {
        const s = { sessionId: generateSessionId(), startTime: nowISO(), completionTime: null };
        setStudent(info);
        setSession(s);
        setHasStarted(true);

        // init progress for each section
        const init = {};
        NAV_SECTIONS.forEach(sec => {
          init[sec.id] = {
            started: sec.id === 'overview',
            startTime: sec.id === 'overview' ? nowISO() : null,
            endTime: null,
            timeSpent: 0, // minutes
            interactions: 0,
            status: sec.id === 'overview' ? 'in-progress' : 'not-started'
          };
        });
        setSectionProgress(init);
        setCurrent('overview');
      };

      const progressPercent = useMemo(() => {
        const ids = NAV_SECTIONS.map(s=>s.id);
        if (!ids.length) return 0;
        const visited = ids.filter(id => sectionProgress[id]?.started).length;
        return Math.round((visited / ids.length) * 100);
      }, [sectionProgress]);

      const updateSection = (id, updates) => {
        setSectionProgress(prev => ({
          ...prev,
          [id]: { ...prev[id], ...updates }
        }));
      };

      const markInteraction = (id) => {
        const cur = sectionProgress[id] || {};
        updateSection(id, { interactions: (cur.interactions || 0) + 1, status: 'in-progress' });
      };

      const navigateTo = (id) => {
        if (id === current) return;

        // close out current section timing
        const curProg = sectionProgress[current];
        if (curProg?.startTime) {
          const minutes = Math.max(0, Math.round((Date.now() - Date.parse(curProg.startTime)) / 60000));
          updateSection(current, {
            endTime: nowISO(),
            timeSpent: (curProg.timeSpent || 0) + minutes,
            status: 'visited'
          });
        }

        // open new section
        const nextProg = sectionProgress[id] || {};
        if (!nextProg.started) {
          updateSection(id, { started: true, startTime: nowISO(), status: 'in-progress' });
        } else {
          // restart timing window
          updateSection(id, { startTime: nowISO(), status: 'in-progress' });
        }
        setCurrent(id);
      };

      const completeSession = () => {
        setSession(prev => ({ ...prev, completionTime: nowISO() }));
      };

      const resetAll = () => {
        if (!confirm('This will clear all saved Part 13 progress. Continue?')) return;
        localStorage.removeItem(STORAGE_KEY);
        location.reload();
      };

      const downloadReport = () => {
        const lines = [];
        lines.push('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
        lines.push('PART 13 ‚Äî Context, Standpoint & Repair ‚Äî Session Report');
        lines.push('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
        lines.push('');
        lines.push(`Name:  ${student.name}`);
        lines.push(`Email: ${student.email}`);
        lines.push(`Course: ${student.course}`);
        lines.push('');
        if (session) {
          lines.push(`Session ID: ${session.sessionId}`);
          lines.push(`Started:    ${new Date(session.startTime).toLocaleString()}`);
          lines.push(`Completed:  ${session.completionTime ? new Date(session.completionTime).toLocaleString() : '(not marked complete)'}`);
        }
        lines.push('');
        lines.push('Sections:');
        let totalMin = 0;
        NAV_SECTIONS.forEach(sec => {
          const sp = sectionProgress[sec.id] || {};
          const minutes = sp.timeSpent || 0;
          totalMin += minutes;
          lines.push(`- ${sec.label}`);
          lines.push(`   status: ${sp.status || 'not-started'} | time: ${minutes} min | interactions: ${sp.interactions || 0}`);
        });
        lines.push('');
        lines.push(`Total recorded time: ${totalMin} minutes`);
        lines.push('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');

        const blob = new Blob([lines.join('\n')], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `Part13-Report-${(student.name||'student').replace(/\s+/g,'_')}.txt`;
        a.click();
      };

      if (!hasStarted) return <Welcome onStart={startModule} />;

      // active section renderer
      const renderSection = () => {
        const onInteraction = () => markInteraction(current);
        switch(current) {
          case 'overview':   return <Overview onInteraction={onInteraction} />;
          case 'concepts':   return <Concepts onInteraction={onInteraction} />;
          case 'threads':    return <Threads onInteraction={onInteraction} />;
          case 'patterns':   return <Patterns onInteraction={onInteraction} />;
          case 'example':    return <Example onInteraction={onInteraction} />;
          case 'assessment': return <Assessment onInteraction={onInteraction} />;
          default:           return <Overview onInteraction={onInteraction} />;
        }
      };

      const activeProgress = sectionProgress[current] || {};
      const activeInteractions = activeProgress.interactions || 0;

      return (
        <div className="min-h-screen">
          <header className="bg-gradient-to-r from-purple-600 to-indigo-600 text-white">
            <div className="max-w-6xl mx-auto px-4 py-6">
              <div className="flex flex-col md:flex-row md:items-end md:justify-between gap-4">
                <div>
                  <h1 className="text-3xl font-extrabold">Part 13 ‚Äî Context, Standpoint & Repair</h1>
                  <p className="opacity-90">Global & Decolonial ‚Ä¢ Feminist ‚Ä¢ Critical Race ‚Ä¢ Indigenous Thought</p>
                  <div className="mt-4 bg-white/20 rounded-full h-2 overflow-hidden">
                    <div className="h-2 bg-white" style={{width: `${progressPercent}%`}}></div>
                  </div>
                  <div className="text-sm mt-1 opacity-90">{progressPercent}% visited</div>
                </div>
                <div className="text-sm">
                  <div className="font-semibold">{student.name}</div>
                  <div className="opacity-90">{student.email}</div>
                  <div className="opacity-90">{student.course}</div>
                  {session && <div className="mt-1 opacity-90">Session: {session.sessionId}</div>}
                </div>
              </div>
            </div>
          </header>

          <nav className="bg-white border-b sticky top-0 z-40">
            <div className="max-w-6xl mx-auto px-4">
              <div className="flex overflow-x-auto space-x-2 py-3">
                {NAV_SECTIONS.map(s => (
                  <button
                    key={s.id}
                    onClick={() => navigateTo(s.id)}
                    className={
                      'px-4 py-2 rounded-lg border ' +
                      (current === s.id
                        ? 'bg-purple-100 border-purple-300 text-purple-800 font-semibold'
                        : 'bg-white border-gray-200 hover:bg-gray-50')
                    }
                    aria-current={current === s.id ? 'page' : undefined}
                  >
                    <span className="mr-2">{s.icon}</span>{s.label}
                  </button>
                ))}
                <div className="ml-auto flex gap-2">
                  <button
                    onClick={completeSession}
                    className="px-3 py-2 rounded-lg border border-emerald-300 bg-emerald-50 text-emerald-800 hover:bg-emerald-100"
                    title="Mark completion time (you can still continue working)"
                  >
                    Mark Complete
                  </button>
                  <button
                    onClick={downloadReport}
                    className="px-3 py-2 rounded-lg border border-indigo-300 bg-indigo-50 text-indigo-800 hover:bg-indigo-100"
                    title="Download a summary of your session"
                  >
                    Download Report
                  </button>
                  <button
                    onClick={resetAll}
                    className="px-3 py-2 rounded-lg border border-rose-300 bg-rose-50 text-rose-800 hover:bg-rose-100"
                    title="Clear all saved data"
                  >
                    Start Over
                  </button>
                </div>
              </div>
            </div>
          </nav>

          <main className="max-w-6xl mx-auto px-4 py-6">
            {renderSection()}
            <div className="text-xs text-gray-500 mt-4">
              Section interactions: {activeInteractions}
            </div>
          </main>

          <footer className="py-8 text-center text-sm text-gray-500">
            ¬© {new Date().getFullYear()} Part 13 ‚Ä¢ ABCD + Four-Levels ‚Ä¢ For classroom use
          </footer>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
